<div class="search-results-page">
  <div class="container py-5">
    <!-- Search Header -->
    <div class="search-header mb-4">
      <h1 class="search-title">
        @if (searchQuery()) {
          <span>{{ 'SEARCH.RESULTS_FOR' | translate }}: "{{ searchQuery() }}"</span>
        } @else {
          <span>{{ 'SEARCH.TITLE' | translate }}</span>
        }
      </h1>
      @if (hasResults()) {
        <p class="search-count">
          {{ totalResults() }} {{ 'SEARCH.PRODUCTS_FOUND' | translate }}
        </p>
      }
    </div>

    <!-- Sort and Filters -->
    @if (hasResults()) {
      <div class="filters-bar mb-4">
        <div class="row align-items-center">
          <div class="col-md-6">
            <label class="me-2">{{ 'SEARCH.SORT_BY' | translate }}:</label>
            <select class="form-select d-inline-block w-auto" [ngModel]="selectedSort()" (change)="onSortChange($event)">
              @for (option of sortOptions; track option.value) {
                <option [value]="option.value">{{ option.label }}</option>
              }
            </select>
          </div>
        </div>
      </div>
    }

    <!-- Loading State -->
    @if (loading()) {
      <div class="loading-container">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">{{ 'SEARCH.LOADING' | translate }}</span>
        </div>
        <p class="mt-3">{{ 'SEARCH.SEARCHING' | translate }}</p>
      </div>
    }

    <!-- No Results -->
    @if (showNoResults()) {
      <div class="no-results">
        <div class="text-center py-5">
          <i class="fas fa-search fa-4x text-muted mb-3"></i>
          <h3>{{ 'SEARCH.NO_RESULTS' | translate }}</h3>
          <p class="text-muted">{{ 'SEARCH.NO_RESULTS_MESSAGE' | translate }}: "{{ searchQuery() }}"</p>
          <p class="text-muted">{{ 'SEARCH.TRY_DIFFERENT' | translate }}</p>
        </div>
      </div>
    }

    <!-- Results Grid -->
    @if (hasResults() && !loading()) {
      <div class="products-grid">
        <div class="row g-4">
          @for (product of products(); track product._id) {
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
              <div class="product-card" (click)="viewProduct(product.slug)">
                <!-- Product Image -->
                <div class="product-image-wrapper">
                  <img
                    [src]="product.images[0] || 'assets/placeholder.jpg'"
                    [alt]="product.name"
                    class="product-image"
                    loading="lazy"
                  />
                  <!-- Discount Badge -->
                  @if (getDiscountPercentage(product) > 0) {
                    <span class="discount-badge">
                      -{{ getDiscountPercentage(product) }}%
                    </span>
                  }
                  <!-- Out of Stock Badge -->
                  @if (!product.inStock) {
                    <span class="stock-badge">
                      {{ 'PRODUCT.OUT_OF_STOCK' | translate }}
                    </span>
                  }
                </div>

                <!-- Product Info -->
                <div class="product-info">
                  @if (product.category) {
                    <p class="product-category">
                      {{ product.category.name }}
                    </p>
                  }
                  <h3 class="product-name">{{ product.name }}</h3>

                  <!-- Price -->
                  <div class="product-price">
                    <span class="current-price">{{ product.price }} جنيها</span>
                    @if (product.compareAtPrice && product.compareAtPrice > product.price) {
                      <span class="original-price">
                        {{ product.compareAtPrice }} جنيها
                      </span>
                    }
                  </div>

                  <!-- Rating -->
                  @if (product.rating) {
                    <div class="product-rating">
                      <span class="stars">
                        @for (star of [1,2,3,4,5]; track star) {
                          <i class="fas fa-star"
                             [class.text-warning]="star <= (product.rating || 0)"
                             [class.text-muted]="star > (product.rating || 0)"></i>
                        }
                      </span>
                      @if (product.reviewCount) {
                        <span class="rating-count">
                          ({{ product.reviewCount }})
                        </span>
                      }
                    </div>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Pagination -->
    @if (hasResults() && totalPages() > 1 && !loading()) {
      <div class="pagination-container mt-5">
        <nav aria-label="Search results pagination">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage() === 1">
              <a class="page-link" (click)="goToPage(currentPage() - 1)" tabindex="-1">
                {{ 'PAGINATION.PREVIOUS' | translate }}
              </a>
            </li>

            <!-- First page -->
            <li class="page-item" [class.active]="currentPage() === 1">
              <a class="page-link" (click)="goToPage(1)">1</a>
            </li>

            <!-- Ellipsis before current page -->
            @if (currentPage() > 3) {
              <li class="page-item disabled">
                <span class="page-link">...</span>
              </li>
            }

            <!-- Pages around current -->
            @for (page of [currentPage() - 1, currentPage(), currentPage() + 1]; track page) {
              @if (page > 1 && page < totalPages()) {
                <li class="page-item" [class.active]="page === currentPage()">
                  <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
                </li>
              }
            }

            <!-- Ellipsis after current page -->
            @if (currentPage() < totalPages() - 2) {
              <li class="page-item disabled">
                <span class="page-link">...</span>
              </li>
            }

            <!-- Last page -->
            @if (totalPages() > 1) {
              <li class="page-item" [class.active]="currentPage() === totalPages()">
                <a class="page-link" (click)="goToPage(totalPages())">{{ totalPages() }}</a>
              </li>
            }

            <li class="page-item" [class.disabled]="currentPage() === totalPages()">
              <a class="page-link" (click)="goToPage(currentPage() + 1)">
                {{ 'PAGINATION.NEXT' | translate }}
              </a>
            </li>
          </ul>
        </nav>
      </div>
    }
  </div>
</div>
